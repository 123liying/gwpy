.. currentmodule:: gwpy.segments

####################################
Data segments (:mod:`gwpy.segments`)
####################################

=======================
Segment representations
=======================

.. currentmodule:: gwpy.segments.segments

It is crucial to instrumental operation, and to analyses of data, that time segments denoting good or bad state of the instrument and its environment are recorded accurately.
To that end, the international collaboration operates using the GPS time standard (seconds since the GPS epoch of midnight January 6 1980), and records such time segments in GPS ``[start, stop)`` pairs.

The :mod:`gwpy.segments` module provides classes and routines for handling these segments. The basic objects are as follows:

.. autosummary::
   :nosignatures:
   :toctree: ../_generated

   Segment
   SegmentList
   SegmentListDict

While these objects are key to representing core data segments, they are usually applied to analyses of data as a `DataQualityFlag`.

==================
Data-quality flags
==================

.. currentmodule:: gwpy.segments.flag

A data-quality flag is a named set of segments that indicate something about instrumental operation.
Each flag is defined by applying some algorithm on data and generating a list of times (segments) that indicate some good or bad condition has been met during those times.
For example, the times during which the LIGO interferometers are operating under 'science-mode' conditions are recorded as the 'science' flag, which are used by data analysis groups to define periods of data over which to run their pipelines.
Conversely, in the last science run (S6, June 2009 - October 2010), high seismic noise around the observatory buildings was recorded in a data-quality flag used by analysis groups to veto periods of analysis due to sub-standard data.

The `DataQualityFlag` object provides a fully-functional representation of these flags.
Each flag has two key attributes:

.. autosummary::
   :toctree: ../_generated

   ~DataQualityFlag.active
   ~DataQualityFlag.valid

In the example of the science-mode flag mentioned above, the :attr:`~DataQualityFlag.valid` `SegmentList` contains all times during which the state of the science condition was known accurately, while the :attr:`~DataQualityFlag.active` `SegmentList` gives those segments during which the science condition was `True`.

--------------------
The Segment Database
--------------------

The LIGO and Virgo instrument utilise hundreds of data-quality flags to record instrumental state on a daily basis.
These flags are stored in a joint segment database - a queryable database recording each flag, its valid and active segment lists, and all metadata associated with its generation.
The segment database is the primary access point for users to study data-quality flags and apply them in their analyses.

The `DataQualityFlag` object comes with a direct link to the segment database, through the :meth:`DataQualityFlag.query` classmethod:

.. automethod:: DataQualityFlag.query
   :noindex:

====================
Segment applications
====================

The major application of data-quality flags is to record times during which the instrument was operating outside of its nominal condition.
These flags are typically generated by analysing auxiliary signals in the instrument that aren't sensitive to gravitational-wave amplitude, but do have a recorded noise coupling into the main gravitational-wave channel.

.. toctree::
   :maxdepth: 1

   thresholding

